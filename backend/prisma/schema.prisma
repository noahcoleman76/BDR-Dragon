generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  BASIC
}

enum TaskListType {
  TODAY
  THIS_WEEK
  THIS_MONTH
  CUSTOM
}

enum TaskStatus {
  OPEN
  COMPLETED
}

enum RecurrenceType {
  NONE
  DAILY
  WEEKLY
}

enum IntegrationScope {
  GLOBAL
  USER
}

enum IntegrationStatusEnum {
  CONFIGURED
  NOT_CONFIGURED
  STUBBED
}

model User {
  id           String       @id @default(cuid())
  email        String       @unique
  passwordHash String
  role         Role         @default(BASIC)
  firstName    String
  lastName     String
  isActive     Boolean      @default(true)

  taskLists    TaskList[]
  tasks        Task[]
  kpiSnapshots KpiSnapshot[]
  userMarkets  UserMarket[]

  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  quotaCalls              Int     @default(0)
  quotaEmails             Int     @default(0)
  quotaMeetingsBooked     Int     @default(0)
  quotaCleanOpportunities Int     @default(0)

}

model Market {
  id                      String        @id @default(cuid())
  name                    String
  geographicDescription   String?
  accountExecutives       String?
  managerName             String?

  startDate               DateTime?

  userMarkets             UserMarket[]

  createdAt               DateTime      @default(now())
  updatedAt               DateTime      @updatedAt
}

model UserMarket {
  id        String  @id @default(cuid())
  userId    String
  marketId  String

  user      User    @relation(fields: [userId], references: [id])
  market    Market  @relation(fields: [marketId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, marketId])
}

model KpiSnapshot {
  id                   String   @id @default(cuid())
  userId               String
  date                 DateTime

  calls                Int      @default(0)
  emails               Int      @default(0)
  meetingsBooked       Int      @default(0)
  meetingsHeld         Int      @default(0)
  opportunitiesCreated Int      @default(0)
  cleanOpportunities   Int      @default(0)

  user                 User     @relation(fields: [userId], references: [id])

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@unique([userId, date])
}

model TaskList {
  id        String        @id @default(cuid())
  userId    String
  name      String
  type      TaskListType  @default(CUSTOM)

  user      User          @relation(fields: [userId], references: [id])
  tasks     Task[]

  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@unique([userId, name])
}

model Task {
  id             String          @id @default(cuid())
  taskListId     String
  userId         String
  title          String
  description    String?
  dueDate        DateTime?
  status         TaskStatus      @default(OPEN)
  recurrenceType RecurrenceType  @default(NONE)

  taskList       TaskList        @relation(fields: [taskListId], references: [id])
  user           User            @relation(fields: [userId], references: [id])

  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}

model IntegrationStatus {
  id               String   @id @default(cuid())
  scope            String   @unique
  salesforceStatus String   @default("NOT_CONFIGURED")
  outreachStatus   String   @default("STUBBED")
  lastSyncAt       DateTime?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

